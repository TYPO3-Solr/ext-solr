<?xml version="1.0" encoding="UTF-8" ?>
<!--
	The config name property is constructed as follows

	tx_solr		- The extension key
	x-y-z		- The extension version this config is meant to work with
	YYYYMMDD	- The date the config file was changed the last time

	When changing the config, the name property must be updated. There is a
	status report - tx_solr_report_SolrconfigStatus - checking against this
	name property, that status check must be updated as well.
-->
<config name="tx_solr-2-5-0--20110805">


	<abortOnConfigurationError>${solr.abortOnConfigurationError:true}</abortOnConfigurationError>


	<!-- Tika / Solr Cell -->
	<lib dir="../dist/" regex="apache-solr-cell-\d.*\.jar" />
	<lib dir="../contrib/extraction/lib" />

	<!-- Clustering -->
	<lib dir="../dist/" regex="apache-solr-clustering-\d.*\.jar" />
	<lib dir="../contrib/clustering/lib/" />

	<!-- Data Import Handler -->
	<lib dir="../dist/" regex="apache-solr-dataimporthandler-.*\.jar" />
	<lib dir="../contrib/dataimporthandler/lib/" />

	<!-- Language Analysis Extras -->
	<lib dir="../dist/" regex="apache-solr-analysis-extras-.*\.jar" />
	<lib dir="../contrib/analysis-extras/lib/" />
	<lib dir="../contrib/analysis-extras/lucene-libs/" />

	<!-- TYPO3 Plugins -->
	<lib dir="../typo3lib/" />


	<indexDefaults>
		<useCompoundFile>false</useCompoundFile>

		<mergeFactor>10</mergeFactor>
		<maxBufferedDocs>1000</maxBufferedDocs>

		<ramBufferSizeMB>32</ramBufferSizeMB>
		<maxMergeDocs>2147483647</maxMergeDocs>
		<maxFieldLength>10000</maxFieldLength>
		<writeLockTimeout>1000</writeLockTimeout>
		<commitLockTimeout>10000</commitLockTimeout>

		<lockType>native</lockType>
	</indexDefaults>


	<mainIndex>
		<useCompoundFile>false</useCompoundFile>
		<ramBufferSizeMB>32</ramBufferSizeMB>
		<mergeFactor>10</mergeFactor>
		<maxMergeDocs>2147483647</maxMergeDocs>
		<maxFieldLength>10000</maxFieldLength>

		<unlockOnStartup>false</unlockOnStartup>

		<reopenReaders>true</reopenReaders>

		<deletionPolicy class="solr.SolrDeletionPolicy">
			<str name="maxCommitsToKeep">1</str>
			<str name="maxOptimizedCommitsToKeep">0</str>
		</deletionPolicy>

		<infoStream file="INFOSTREAM.txt">false</infoStream>
	</mainIndex>


	<updateHandler class="solr.DirectUpdateHandler2">
		<autoCommit>
			<maxDocs>100</maxDocs>
			<maxTime>3600000</maxTime>
		</autoCommit>
	</updateHandler>


	<query>
		<maxBooleanClauses>1024</maxBooleanClauses>

		<filterCache
			class="solr.FastLRUCache"
			size="512"
			initialSize="512"
			autowarmCount="256"/>

		<queryResultCache
			class="solr.LRUCache"
			size="512"
			initialSize="512"
			autowarmCount="0"/>

		<documentCache
			class="solr.LRUCache"
			size="512"
			initialSize="512"
			autowarmCount="0"/>

		<enableLazyFieldLoading>true</enableLazyFieldLoading>

		<queryResultWindowSize>20</queryResultWindowSize>

		<queryResultMaxDocsCached>200</queryResultMaxDocsCached>


		<listener event="newSearcher" class="solr.QuerySenderListener">
			<arr name="queries">

			</arr>
		</listener>

		<listener event="firstSearcher" class="solr.QuerySenderListener">
			<arr name="queries">

			</arr>
		</listener>

		<useColdSearcher>false</useColdSearcher>

		<maxWarmingSearchers>2</maxWarmingSearchers>
	</query>


	<requestDispatcher handleSelect="true" >
		<!--Make sure your system has some authentication!  -->
		<requestParsers enableRemoteStreaming="true" multipartUploadLimitInKB="2048000" />

		<httpCaching lastModifiedFrom="openTime" etagSeed="Solr" />
	</requestDispatcher>


	<requestHandler name="standard" class="solr.SearchHandler">
		<lst name="defaults">
			<str name="echoParams">explicit</str>
		</lst>
		<arr name="last-components">
			<str>spellcheck</str>
		</arr>
	</requestHandler>


	<requestHandler name="dismax" class="solr.SearchHandler" >
		<lst name="defaults">
			<str name="defType">edismax</str>
			<str name="echoParams">explicit</str>
		</lst>
	</requestHandler>


	<requestHandler name="partitioned" class="solr.SearchHandler" default="true">
		<lst name="defaults">
		<str name="defType">edismax</str>
		<str name="echoParams">explicit</str>
		<str name="qf">content^40.0 title^5.0 keywords^2.0 tagsH1^5.0 tagsH2H3^3.0 tagsH4H5H6^2.0 tagsInline^1.0</str>
		<str name="pf">content^2.0</str>
		<int name="ps">15</int>

		<str name="mm">2&lt;-35%</str>

		<str name="hl.fl">title,content</str>
		<int name="hl.snippets">3</int>
		<str name="hl.mergeContiguous">true</str>
		<str name="hl.requireFieldMatch">true</str>

		<str name="f.content.hl.alternateField">content</str>
		<str name="f.content.hl.maxAlternateFieldLength">200</str>

		<str name="spellcheck">false</str>
		<str name="spellcheck.onlyMorePopular">false</str>
		<str name="spellcheck.extendedResults">false</str>
			<str name="spellcheck.count">1</str>
		</lst>

		<arr name="last-components">
			<str>spellcheck</str>
			<str>elevator</str>
		</arr>
	</requestHandler>


	<requestHandler name="mlt" class="solr.MoreLikeThisHandler">
		<lst name="defaults">
			<str name="mlt.mintf">1</str>
			<str name="mlt.mindf">1</str>
			<str name="mlt.minwl">3</str>
			<str name="mlt.maxwl">15</str>
			<str name="mlt.maxqt">20</str>
			<str name="mlt.match.include">false</str>
		</lst>
	</requestHandler>


	<requestHandler name="/analysis/document" class="solr.DocumentAnalysisRequestHandler" />


	<requestHandler name="/analysis/field" class="solr.FieldAnalysisRequestHandler" />


	<requestHandler name="/update" class="solr.XmlUpdateRequestHandler" />


	<requestHandler name="/update/csv" class="solr.CSVRequestHandler" startup="lazy" />


	<requestHandler name="/update/extract" class="org.apache.solr.handler.extraction.ExtractingRequestHandler" startup="lazy" />


<!--
	<requestHandler name="/dataimport" class="org.apache.solr.handler.dataimport.DataImportHandler">
		<lst name="defaults">
			<str name="config">data-config.xml</str>
		</lst>
	</requestHandler>
 -->


	<requestHandler name="/terms" class="org.apache.solr.handler.component.SearchHandler" startup="lazy">
		<lst name="defaults">
			<bool name="terms">true</bool>
		</lst>
		<arr name="components">
			<str>termsComponent</str>
		</arr>
	</requestHandler>


	<requestHandler name="/elevate" class="solr.SearchHandler" startup="lazy">
		<lst name="defaults">
			<str name="echoParams">explicit</str>
		</lst>
		<arr name="last-components">
			<str>elevator</str>
		</arr>
	</requestHandler>


	<requestHandler name="/admin/" class="org.apache.solr.handler.admin.AdminHandlers" />


	<requestHandler name="/admin/ping" class="PingRequestHandler">
		<lst name="defaults">
			<str name="qt">standard</str>
			<str name="q">solrpingquery</str>
			<str name="echoParams">all</str>
		</lst>
	</requestHandler>


	<requestHandler name="/debug/dump" class="solr.DumpRequestHandler" >
		<lst name="defaults">
		<str name="echoParams">explicit</str> <!-- for all params (including the default etc) use: 'all' -->
		<str name="echoHandler">true</str>
		</lst>
	</requestHandler>


	<requestHandler name="/clustering"
					enable="${solr.clustering.enabled:false}"
					class="solr.SearchHandler">

		<lst name="defaults">
			<bool name="clustering">true</bool>
			<str name="clustering.engine">default</str>
			<bool name="clustering.results">true</bool>
			<!-- The title field -->
			<str name="carrot.title">name</str>
			<str name="carrot.url">id</str>
			<!-- The field to cluster on -->
			<str name="carrot.snippet">features</str>
			<!-- produce summaries -->
			<bool name="carrot.produceSummary">true</bool>
			<!-- the maximum number of labels per cluster -->
			<!--<int name="carrot.numDescriptions">5</int>-->
			<!-- produce sub clusters -->
			<bool name="carrot.outputSubClusters">false</bool>
		</lst>
		<arr name="last-components">
			<str>clusteringComponent</str>
		</arr>
	</requestHandler>


	<searchComponent
		name="clusteringComponent"
		enable="${solr.clustering.enabled:false}"
		class="org.apache.solr.handler.clustering.ClusteringComponent" >

		<lst name="engine">
			<str name="name">default</str>
			<str name="carrot.algorithm">org.carrot2.clustering.lingo.LingoClusteringAlgorithm</str>
			<str name="LingoClusteringAlgorithm.desiredClusterCountBase">20</str>
		</lst>

		<lst name="engine">
			<str name="name">stc</str>
			<str name="carrot.algorithm">org.carrot2.clustering.stc.STCClusteringAlgorithm</str>
		</lst>
	</searchComponent>


	<searchComponent name="spellcheck" class="solr.SpellCheckComponent">
		<str name="queryAnalyzerFieldType">textSpell</str>

		<lst name="spellchecker">
			<str name="name">default</str>
			<str name="field">spell</str>
			<str name="buildOnOptimize">true</str>
			<str name="spellcheckIndexDir">./spellchecker1</str>
		</lst>
	</searchComponent>


	<searchComponent name="termsComponent" class="org.apache.solr.handler.component.TermsComponent"/>


	<searchComponent name="elevator" class="solr.QueryElevationComponent" >
		<str name="queryFieldType">string</str>
		<str name="config-file">elevate.xml</str>
		<str name="forceElevation">true</str>
	</searchComponent>


	<highlighting>
		<fragmenter name="gap" class="org.apache.solr.highlight.GapFragmenter" default="true">
			<lst name="defaults">
				<int name="hl.fragsize">100</int>
			</lst>
		</fragmenter>

		<formatter name="html" class="org.apache.solr.highlight.HtmlFormatter" default="true">
			<lst name="defaults">
				<str name="hl.simple.pre"><![CDATA[<em>]]></str>
				<str name="hl.simple.post"><![CDATA[</em>]]></str>
			</lst>
		</formatter>
	</highlighting>


	<queryResponseWriter name="php" class="org.apache.solr.response.PHPResponseWriter"/>
	<queryResponseWriter name="phps" class="org.apache.solr.response.PHPSerializedResponseWriter"/>
	<queryResponseWriter name="xslt" class="org.apache.solr.response.XSLTResponseWriter">
		<int name="xsltCacheLifetimeSeconds">5</int>
	</queryResponseWriter>


	<!-- TYPO3 specific plugins, request handlers -->
	<queryParser name="typo3access" class="org.typo3.solr.search.AccessFilterQParserPlugin"/>


	<admin>
		<defaultQuery>*:*</defaultQuery>
	</admin>

</config>